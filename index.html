<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GenerLink Compatibility Checker ‚Äì Generator Solutions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --midnight:#020921;
      --card:#050b1b;
      --text:#f5f7ff;
      --muted:#b6c2e3;
      --border: rgba(255,255,255,0.10);
      --shadow: rgba(0,0,0,0.60);

      --ok:#4ade80;
      --warn:#facc15;
      --bad:#f87171;

      --cta1a:#fbbf24;
      --cta1b:#f97316;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at top, #0b1f4a 0, var(--midnight) 45%, #000 100%);
      padding: 22px 16px 40px;
      display:flex;
      justify-content:center;
    }

    .wrap{width:100%;max-width:1100px}

    header{
      text-align:center;
      margin-bottom: 18px;
    }
    .brand{
      display:flex;
      justify-content:center;
      margin-bottom:10px;
    }
    .brand img{
      height:70px;
      width:auto;
      max-width: 92vw;
      filter: drop-shadow(0 0 4px rgba(255,255,255,0.70));
    }
    h1{font-size:1.85rem;margin-bottom:6px}
    .tagline{
      color: var(--muted);
      font-size:0.95rem;
      max-width: 760px;
      margin: 0 auto;
      line-height:1.35;
    }

    .layout{
      display:grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
      gap: 20px;
      margin-top: 20px;
      align-items:start;
    }
    @media (max-width: 900px){
      .layout{grid-template-columns: minmax(0,1fr)}
    }

    .card{
      background: radial-gradient(circle at top, #101935 0, var(--card) 58%);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 18px;
      padding: 18px 18px 22px;
      box-shadow: 0 18px 50px var(--shadow);
    }
    .card h2{font-size:1.15rem;margin-bottom:6px}
    .sub{
      color: var(--muted);
      font-size:0.9rem;
      margin-bottom: 14px;
      line-height:1.35;
    }

    .section-title{
      color: var(--muted);
      font-size:0.82rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      margin: 14px 0 6px;
    }

    .grid-2{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 12px;
    }
    @media (max-width: 640px){
      .grid-2{grid-template-columns: minmax(0,1fr)}
    }

    label{display:block;font-size:0.9rem}
    input[type="text"], input[type="email"], select, textarea{
      width:100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(3,7,18,0.85);
      color: var(--text);
      outline:none;
      font-size: 0.95rem;
    }
    textarea{min-height: 70px; resize: vertical;}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(245,158,11,0.85);
      box-shadow: 0 0 0 1px rgba(245,158,11,0.35);
    }
    .hint{
      color: var(--muted);
      font-size: 0.8rem;
      margin-top: 4px;
      line-height:1.3;
    }

    .pill-group{display:flex;flex-wrap:wrap;gap:8px}
    .pill{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,23,42,0.92);
      font-size: 0.86rem;
      cursor:pointer;
      user-select:none;
    }
    .pill input{
      position:absolute;
      opacity:0;
      pointer-events:none;
    }
    .pill span{pointer-events:none}
    .pill .bg{
      position:absolute;
      inset:-1px;
      border-radius:inherit;
      background: radial-gradient(circle at top, #fed7aa, #f97316);
      opacity:0;
      transform: scale(0.92);
      transition: all 0.16s ease-out;
      z-index:-1;
    }
    .pill input:checked ~ .bg{
      opacity:1;
      transform:scale(1);
    }
    .pill input:checked + span{
      color:#020617;
      font-weight:700;
    }

    .buttons{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top: 16px;
    }
    button{
      border:none;
      border-radius:999px;
      padding: 9px 16px;
      font-size:0.95rem;
      cursor:pointer;
      font-weight: 700;
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .primary{
      background: linear-gradient(135deg, var(--cta1a), var(--cta1b));
      color:#020617;
      box-shadow: 0 0 20px rgba(248,250,252,0.18), 0 8px 25px rgba(0,0,0,0.85);
    }
    .secondary{
      background: rgba(15,23,42,0.95);
      color: var(--text);
      border: 1px solid rgba(148,163,184,0.45);
    }
    .primary:hover{filter:brightness(1.05)}
    .secondary:hover{border-color: rgba(245,158,11,0.9)}

    .result-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 6px;
    }
    .badge{
      font-size:0.75rem;
      text-transform:uppercase;
      letter-spacing:0.16em;
      padding: 4px 9px;
      border-radius:999px;
      border: 1px solid rgba(148,163,184,0.55);
      color: var(--muted);
      white-space:nowrap;
    }
    .ok{border-color: var(--ok); color: var(--ok);}
    .warn{border-color: var(--warn); color: var(--warn);}
    .bad{border-color: var(--bad); color: var(--bad);}

    .result-title{
      font-size: 1.65rem;
      font-weight: 800;
      margin: 6px 0 4px;
    }
    .result-summary{
      color: var(--muted);
      line-height:1.35;
      margin-bottom: 10px;
    }

    .tags{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:10px}
    .tag{
      font-size:0.78rem;
      padding: 4px 8px;
      border-radius:999px;
      background: rgba(15,23,42,0.90);
      border: 1px solid rgba(148,163,184,0.5);
    }
    .tag.ok{border-color: var(--ok); color: var(--ok);}
    .tag.warn{border-color: var(--warn); color: var(--warn);}
    .tag.bad{border-color: var(--bad); color: var(--bad);}

    ul.summary{
      list-style:none;
      color: var(--muted);
      font-size: 0.88rem;
      margin: 8px 0 12px;
    }
    ul.summary li{margin-bottom:4px}

    .box{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(15,23,42,0.75);
      border: 1px solid rgba(148,163,184,0.40);
      font-size: 0.88rem;
      color: var(--muted);
      line-height:1.35;
      display:none;
    }
    .box strong{color: rgba(245,158,11,0.95)}

    .divider{
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(148,163,184,0.35);
    }

    .legal{
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.80rem;
      line-height: 1.35;
    }

    .statusline{
      margin-top: 8px;
      font-size: 0.82rem;
      color: var(--muted);
    }
    .statusline strong{color: var(--text)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <!-- If logo.png isn't present, page still works; you'll just see broken image.
             Keep logo.png in the same folder as index.html, or remove this <img>. -->
        <img src="./logo.png" alt="Generator Solutions Logo" onerror="this.style.display='none';" />
      </div>
      <h1>GenerLink Compatibility Checker</h1>
      <p class="tagline">
        Enter your portable generator details and we‚Äôll compare them to our current compatibility reference database.
      </p>
    </header>

    <main class="layout">
      <!-- LEFT CARD -->
      <section class="card">
        <h2>Your Generator Details</h2>
        <p class="sub">
          Use the manufacturer name and model number exactly as shown on the generator nameplate for best results.
        </p>

        <div class="section-title">Manufacturer & Model</div>
        <div class="grid-2">
          <label>
            Manufacturer
            <input
              type="text"
              id="genBrand"
              list="manufacturerList"
              placeholder="Start typing‚Ä¶ (e.g. Generac, Honda, Firman)"
              autocomplete="off"
            />
            <datalist id="manufacturerList"></datalist>
            <div class="hint">Auto-suggest comes from the loaded database.</div>
          </label>

          <label>
            Generator Model Number
            <input type="text" id="genModel" placeholder="e.g. GP8000E, P08008, EU7000is" autocomplete="off" />
            <div class="hint">Type the exact model from the data plate.</div>
          </label>
        </div>

        <div class="section-title">Revision / Version (optional)</div>
        <div class="grid-2">
          <label>
            Revision / Version
            <input type="text" id="genRev" placeholder="e.g. REV 00, REV 01, A, B" autocomplete="off" />
          </label>

          <label>
            Generator Type
            <input type="text" value="Portable generator" disabled />
            <input type="hidden" id="genType" value="portable" />
            <div class="hint">This tool is for portable generators (GenerLink use case).</div>
          </label>
        </div>

        <div class="section-title">Approximate Output</div>
        <div class="pill-group" role="group" aria-label="Wattage">
          <label class="pill">
            <input type="radio" name="watts" value="under5" />
            <span>Under 5 kW</span>
            <div class="bg"></div>
          </label>
          <label class="pill">
            <input type="radio" name="watts" value="5to8" checked />
            <span>5 ‚Äì 8 kW</span>
            <div class="bg"></div>
          </label>
          <label class="pill">
            <input type="radio" name="watts" value="8to12" />
            <span>8 ‚Äì 12 kW</span>
            <div class="bg"></div>
          </label>
          <label class="pill">
            <input type="radio" name="watts" value="12to15" />
            <span>12 ‚Äì 15 kW</span>
            <div class="bg"></div>
          </label>
          <label class="pill">
            <input type="radio" name="watts" value="over15" />
            <span>15 kW +</span>
            <div class="bg"></div>
          </label>
        </div>
        <div class="hint">If unsure, use the running watts from the manual or nameplate.</div>

        <div class="buttons">
          <button class="primary" type="button" onclick="runCompatibilityCheck()">
            ‚ö° Check Compatibility
          </button>
          <button class="secondary" type="button" onclick="resetChecker()">
            Reset
          </button>
        </div>

        <div class="statusline" id="dataStatus">
          Loading compatibility database‚Ä¶
        </div>
      </section>

      <!-- RIGHT CARD -->
      <section class="card">
        <div class="result-head">
          <h2>Compatibility Result</h2>
          <span class="badge" id="statusBadge">Waiting for input‚Ä¶</span>
        </div>

        <div class="result-title" id="resultTitle">No result yet</div>
        <p class="result-summary" id="resultSummary">
          Enter your generator details and click ‚ÄúCheck Compatibility‚Äù.
        </p>

        <div class="tags" id="resultTags"></div>

        <ul class="summary" id="summaryList">
          <li>Manufacturer: ‚Äî</li>
          <li>Model: ‚Äî</li>
          <li>Revision: ‚Äî</li>
          <li>Generator type: Portable generator</li>
          <li>Approximate output: ‚Äî</li>
        </ul>

        <div class="box" id="nextStepsBox">
          <strong>Suggested next steps:</strong>
          <div id="nextStepsText" style="margin-top:6px;"></div>
        </div>

        <p class="legal">
          <strong>Disclaimer:</strong>
          This tool is based on the most current GenerLink compatibility information available to us.
          It is provided for reference <strong>ONLY</strong>.
          Always consult with your local electrical authority and/or a licensed electrician to ensure that
          <u><strong>YOUR</strong></u> portable generator is compatible with the GenerLink unit selected.
        </p>

        <div class="divider" id="emailSection">
          <h2 style="font-size:1.05rem;margin-bottom:6px;">Email These Results</h2>
          <p class="sub" style="margin-bottom:10px;">
            Create an email draft addressed to <strong>sales@generatorsolutions.ca</strong> with you on copy.
          </p>

          <div class="grid-2">
            <label>
              Your name
              <input type="text" id="custName" placeholder="e.g. Jane Smith" autocomplete="off" />
            </label>
            <label>
              Your email address
              <input type="email" id="custEmail" placeholder="you@example.com" autocomplete="off" />
            </label>
          </div>

          <div class="grid-2" style="margin-top:10px;">
            <label>
              Phone number (required for consultation)
              <input type="text" id="custPhone" placeholder="e.g. (705) 286-1003" autocomplete="off" />
            </label>
            <label>
              Installation address (required for consultation)
              <input type="text" id="installAddress" placeholder="Street, City, Province, Postal Code" autocomplete="off" />
            </label>
          </div>

          <div class="buttons">
            <button class="primary" type="button" onclick="openEmailDraft('results')">
              ‚úâÔ∏è Email Compatibility Result
            </button>
            <button class="secondary" type="button" onclick="openEmailDraft('consultation')">
              üìç Book a GenerLink Consultation
            </button>
          </div>

          <div class="hint">
            ‚ÄúConsultation‚Äù requires phone + full address so we can confirm service area and prepare properly.
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    console.log("‚úÖ Script loaded");

    // Global compatibility dataset ‚Äì loaded from JSON file
    let COMPAT_DATA = [];
    let compatLoaded = false;

    function normalize(str) {
      return (str || "")
        .toString()
        .trim()
        .toUpperCase()
        .replace(/[\s\-_\/]+/g, "");
    }

    function describeWattageChoice(val) {
      switch (val) {
        case "under5": return "Under 5 kW";
        case "5to8": return "5 ‚Äì 8 kW";
        case "8to12": return "8 ‚Äì 12 kW";
        case "12to15": return "12 ‚Äì 15 kW";
        case "over15": return "15 kW +";
        default: return "Not specified";
      }
    }

    function classifyDbWatts(wattsStr) {
      const n = parseInt(wattsStr || "", 10);
      if (!n || Number.isNaN(n)) return "";
      if (n < 4000) return "Light-duty (under ~4 kW)";
      if (n < 8000) return "Typical essential-load portable";
      if (n < 12000) return "Mid-range output";
      return "High-output portable (confirm cord & load plan)";
    }

    function populateManufacturerDatalist(data) {
      const dl = document.getElementById("manufacturerList");
      if (!dl) return;

      const set = new Set();
      data.forEach(row => {
        if (row && row.manufacturer) {
          const m = row.manufacturer.toString().trim();
          if (m) set.add(m);
        }
      });

      const manufacturers = Array.from(set).sort((a, b) => a.localeCompare(b));
      dl.innerHTML = "";
      manufacturers.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m;
        dl.appendChild(opt);
      });
    }

    function findInDatabase(manufacturer, model) {
      const mfgNorm = normalize(manufacturer);
      const modelNorm = normalize(model);

      if (!mfgNorm || !modelNorm) return null;

      // exact match first
      for (const row of COMPAT_DATA) {
        if (normalize(row.manufacturer) === mfgNorm && normalize(row.model) === modelNorm) {
          return { row, confidence: "exact" };
        }
      }

      // partial match (same manufacturer, model contains input)
      for (const row of COMPAT_DATA) {
        if (normalize(row.manufacturer) !== mfgNorm) continue;
        const rm = normalize(row.model);
        if (rm.includes(modelNorm) || modelNorm.includes(rm)) {
          return { row, confidence: "partial" };
        }
      }

      return null;
    }

    function setBadge(text, cls) {
      const b = document.getElementById("statusBadge");
      b.textContent = text;
      b.classList.remove("ok", "warn", "bad");
      if (cls) b.classList.add(cls);
    }

    function setText(id, text) {
      const el = document.getElementById(id);
      if (el) el.textContent = text;
    }

    function runCompatibilityCheck() {
      // Always start fresh
      window._lastCheck = null;

      if (!compatLoaded) {
        alert("Compatibility database is still loading. Please refresh and try again in a moment.");
        return;
      }

      const manufacturer = (document.getElementById("genBrand")?.value || "").trim();
      const model = (document.getElementById("genModel")?.value || "").trim();
      const rev = (document.getElementById("genRev")?.value || "").trim();
      const wattsChoice = document.querySelector('input[name="watts"]:checked')?.value || "5to8";

      if (!manufacturer || !model) {
        alert("Please enter both the manufacturer and model number.");
        return;
      }

      const hit = findInDatabase(manufacturer, model);

      // UI elements
      const tags = document.getElementById("resultTags");
      const list = document.getElementById("summaryList");
      const stepsBox = document.getElementById("nextStepsBox");
      const stepsText = document.getElementById("nextStepsText");

      tags.innerHTML = "";
      stepsBox.style.display = "none";
      stepsText.innerHTML = "";

      // helper tag
      const addTag = (txt, cls) => {
        const s = document.createElement("span");
        s.className = "tag" + (cls ? (" " + cls) : "");
        s.textContent = txt;
        tags.appendChild(s);
      };

      // summary list
      const items = [];
      items.push(`Manufacturer: ${manufacturer}`);
      items.push(`Model: ${model}`);
      items.push(`Revision: ${rev || "Not specified"}`);
      items.push(`Generator type: Portable generator`);
      items.push(`Approximate output (your selection): ${describeWattageChoice(wattsChoice)}`);

      // default result state
      let mainTitle = "Not Found in Reference";
      let summary = "This exact model does not appear in our current internal reference. It may still be compatible, but it must be verified against the latest official GenerLink list and your local utility‚Äôs requirements.";
      let statusLabel = "Not listed ‚Äì manual review";
      let statusClass = "";
      let plugType = "";
      let dbWatts = "";
      let dbWattClass = "";
      let statusCode = "unknown";

      if (hit) {
        const row = hit.row;
        statusCode = row.status || "check";
        plugType = row.plug_type || "";
        dbWatts = row.wattage || "";
        dbWattClass = classifyDbWatts(dbWatts);

        // Map status codes
        if (statusCode === "yes") {
          mainTitle = "Likely Compatible";
          summary = row.notes || "This generator appears in our reference as compatible with GenerLink.";
          statusLabel = "Compatible (guide only)";
          statusClass = "ok";
        } else if (statusCode === "no") {
          mainTitle = "Not Listed as Compatible";
          summary = row.notes || "This generator is not listed as compatible in our current reference.";
          statusLabel = "Not listed as compatible";
          statusClass = "bad";
        } else {
          mainTitle = "Requires Manual Review";
          summary = row.notes || "Compatibility may depend on plug type, neutral bonding, or local utility rules.";
          statusLabel = "Manual check recommended";
          statusClass = "warn";
        }

        addTag(`Confidence: ${hit.confidence}`, hit.confidence === "exact" ? "ok" : "warn");
      }

      // Badge + main text
      setBadge(statusLabel, statusClass);
      setText("resultTitle", mainTitle);
      setText("resultSummary", summary);

      // Tags
      addTag(`Manufacturer: ${manufacturer}`);
      addTag(`Model: ${model}`);
      if (rev) addTag(`Revision: ${rev}`);
      addTag(`Portable generator`, "ok");
      addTag(`Output (you): ${describeWattageChoice(wattsChoice)}`);

      if (dbWatts) addTag(`Reference watts: ${dbWatts} W`, "ok");
      if (dbWattClass) addTag(`Load class: ${dbWattClass}`, "ok");

      if (plugType) {
        addTag(`Plug: ${plugType}`, "ok");
        if (plugType.includes("TT-30") && !plugType.includes("L14-30")) {
          addTag("TT-30 is typically 120V only ‚Äî confirm suitability", "warn");
        }
      } else {
        addTag("Plug type not specified ‚Äî confirm 120/240V outlet (e.g., L14-30)", "warn");
      }

      if (statusCode === "no") addTag("Not recommended (based on reference)", "bad");
      if (statusCode === "check" || statusCode === "unknown") addTag("Manual verification required", "warn");

      // Summary list render
      list.innerHTML = "";
      items.forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        list.appendChild(li);
      });

      // Next steps box
      const steps = [];
      if (statusCode === "yes") {
        steps.push("‚Ä¢ Confirm against the latest official GenerLink compatibility list.");
        steps.push("‚Ä¢ Ensure correct 120/240V outlet (often L14-30) and properly rated cord.");
        steps.push("‚Ä¢ We recommend a quick review with our team before purchase/installation.");
      } else if (statusCode === "no") {
        steps.push("‚Ä¢ This model is not listed as compatible in our current reference.");
        steps.push("‚Ä¢ Contact Generator Solutions to review compatible generator options and GenerLink sizing.");
      } else {
        steps.push("‚Ä¢ This model requires manual compatibility confirmation.");
        steps.push("‚Ä¢ Please provide photos of the data plate and outlet panel if available.");
        steps.push("‚Ä¢ We‚Äôll verify against the official list and local utility rules.");
      }

      stepsBox.style.display = "block";
      stepsText.innerHTML = steps.join("<br>");

      // Store for email
      window._lastCheck = {
        statusLabel,
        mainTitle,
        summary,
        manufacturer,
        model,
        rev,
        wattsChoiceLabel: describeWattageChoice(wattsChoice),
        dbWatts,
        plugType,
        dbWattClass,
        statusCode
      };
    }

    function resetChecker() {
      document.getElementById("genBrand").value = "";
      document.getElementById("genModel").value = "";
      document.getElementById("genRev").value = "";

      document.querySelectorAll('input[name="watts"]').forEach(r => {
        r.checked = (r.value === "5to8");
      });

      setBadge("Waiting for input‚Ä¶", "");
      setText("resultTitle", "No result yet");
      setText("resultSummary", "Enter your generator details and click ‚ÄúCheck Compatibility‚Äù.");

      document.getElementById("resultTags").innerHTML = "";
      document.getElementById("summaryList").innerHTML = `
        <li>Manufacturer: ‚Äî</li>
        <li>Model: ‚Äî</li>
        <li>Revision: ‚Äî</li>
        <li>Generator type: Portable generator</li>
        <li>Approximate output: ‚Äî</li>
      `;

      document.getElementById("nextStepsBox").style.display = "none";
      document.getElementById("nextStepsText").innerHTML = "";

      window._lastCheck = null;
    }

    function openEmailDraft(source) {
      source = source || "results";

      const check = window._lastCheck;
      if (!check) {
        alert("Please run the compatibility check first so we can include your results.");
        return;
      }

      const name = (document.getElementById("custName")?.value || "").trim();
      const email = (document.getElementById("custEmail")?.value || "").trim();
      const phone = (document.getElementById("custPhone")?.value || "").trim();
      const address = (document.getElementById("installAddress")?.value || "").trim();

      if (!email) {
        alert("Please enter your email address so we can include it in the message.");
        return;
      }

      if (source === "consultation") {
        if (!phone) {
          alert("Please enter your phone number so we can contact you to book the consultation.");
          return;
        }
        if (!address) {
          alert("Please enter the full installation address so we can confirm service area and prepare properly.");
          return;
        }
      }

      const subject = encodeURIComponent(
        source === "consultation"
          ? "GenerLink Consultation Request ‚Äì Compatibility Check (Generator Solutions)"
          : "GenerLink Compatibility Check ‚Äì Generator Solutions"
      );

      const lines = [];
      lines.push("Hello Generator Solutions Team,");
      lines.push("");
      lines.push("Here are my GenerLink compatibility results from your online checker:");
      lines.push("");
      lines.push(`‚Ä¢ CTA used: ${source === "consultation" ? "Book a GenerLink Consultation" : "Email Compatibility Result"}`);
      lines.push(`‚Ä¢ Status: ${check.mainTitle} (${check.statusLabel})`);
      lines.push(`‚Ä¢ Summary: ${check.summary}`);
      lines.push("");
      lines.push("Generator details:");
      lines.push(`‚Ä¢ Manufacturer: ${check.manufacturer}`);
      lines.push(`‚Ä¢ Model: ${check.model}`);
      lines.push(`‚Ä¢ Revision: ${check.rev || "(not specified)"}`);
      lines.push(`‚Ä¢ Generator type: Portable generator`);
      lines.push(`‚Ä¢ Approximate output (my selection): ${check.wattsChoiceLabel}`);
      if (check.dbWatts) lines.push(`‚Ä¢ Approximate output (reference): ${check.dbWatts} W`);
      if (check.plugType) lines.push(`‚Ä¢ Plug type (reference): ${check.plugType}`);
      if (check.dbWattClass) lines.push(`‚Ä¢ Load class: ${check.dbWattClass}`);

      lines.push("");
      lines.push("My contact details:");
      lines.push(`‚Ä¢ Name: ${name || "(not provided)"}`);
      lines.push(`‚Ä¢ Email: ${email}`);

      if (source === "consultation") {
        lines.push(`‚Ä¢ Phone: ${phone}`);
        lines.push(`‚Ä¢ Installation address: ${address}`);
      }

      lines.push("");
      lines.push("Please review this information against the official GenerLink compatibility list and my local utility's requirements, and let me know:");
      lines.push("‚Ä¢ If this generator is compatible, and");
      lines.push("‚Ä¢ Any recommendations or next steps.");
      if (source === "consultation") {
        lines.push("");
        lines.push("I would also like to book a GenerLink consultation / installation assessment.");
      }
      lines.push("");
      lines.push("Thank you!");

      const body = encodeURIComponent(lines.join("\n"));
      const mailto = `mailto:sales@generatorsolutions.ca?cc=${encodeURIComponent(email)}&subject=${subject}&body=${body}`;
      window.location.href = mailto;
    }

    // Load DB after DOM exists so datalist is always present
    window.addEventListener("DOMContentLoaded", () => {
      const status = document.getElementById("dataStatus");

      fetch("./generlink_compat_data.json")
        .then(res => {
          if (!res.ok) throw new Error(`JSON load failed: ${res.status}`);
          return res.json();
        })
        .then(data => {
          COMPAT_DATA = Array.isArray(data) ? data : [];
          compatLoaded = true;
          populateManufacturerDatalist(COMPAT_DATA);

          if (status) {
            status.innerHTML = `Database loaded: <strong>${COMPAT_DATA.length.toLocaleString()}</strong> models ‚úÖ`;
          }
        })
        .catch(err => {
          console.error("‚ùå Error loading compatibility data:", err);
          if (status) {
            status.innerHTML = `Database error: <strong>could not load</strong> ‚ùå (check file path/name)`;
          }
        });
    });
  </script>
</body>
</html>
